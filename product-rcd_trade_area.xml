<?xml version="1.0" encoding="ISO-8859-1"?>

<product productid="rcd_trade_area" active="1">
	<title>Trade Area</title>
	<description />
	<version>0.11</version>
	<url />
	<versioncheckurl />
	<apm_releasedate>0</apm_releasedate>
	<apm_author />
	<apm_relatedurl />
	<apm_extrainfo />
	<apm_extraedit />
	<dependencies>
	</dependencies>
	<codes>
		<code version="*">
			<installcode><![CDATA[if ($vbulletin->products['tms'])
{
	require_once(DIR . '/includes/adminfunctions_templateedits.php');
	install_templateedits($info, $arr, $active);
}]]></installcode>
			<uninstallcode><![CDATA[if ($vbulletin->products['tms'])
{
	require_once(DIR . '/includes/adminfunctions_templateedits.php');
	uninstall_templateedits($vbulletin->GPC['productid']);
}]]></uninstallcode>
		</code>
	</codes>
	<templates>
	</templates>
	<stylevardfns>
	</stylevardfns>
	<stylevars>
	</stylevars>
	<plugins>
		<plugin active="1" executionorder="5">
			<title>Forum display query modification</title>
			<hookname>forumdisplay_query</hookname>
			<phpcode><![CDATA[if (is_rcd_ta_enabled() )
{
  $show['rcd_ta_city'] = true;

  $hook_query_fields =
    ', TAUF.`field2` AS threadusercity';

  $hook_query_joins  =
    ' LEFT JOIN ' . TABLE_PREFIX . 'userfield AS TAUF ON( thread.postuserid = TAUF.userid ) ';
}]]></phpcode>
		</plugin>
		<plugin active="1" executionorder="5">
			<title>Declare function in global namespace</title>
			<hookname>global_bootstrap_complete</hookname>
			<phpcode><![CDATA[function is_rcd_ta_enabled()
{
    global $vbulletin,$foruminfo;
    $ta_forums     = explode(',', $vbulletin->options['rcd_ta_forum_ids']);
    $forum_parent_list = explode(',', $foruminfo['parentlist']);
    $x_and_children = $vbulletin->options['rcd_ta_x_and_children'];
    foreach ($ta_forums AS $ta_forum_id)
    {
        if ($x_and_children)
        {
            if (in_array($ta_forum_id, $forum_parent_list))
            {
                return true;
            }
        }
        else
        {
            if ($ta_forum_id == $foruminfo['forumid'])
            {
                return true;
            }
        }
    }
    return false;
}

if (is_rcd_ta_enabled())
{
    $vbulletin->options['edittimelimit'] = $vbulletin->options['rcd_ta_doublepost_timespan']; 

    // Sync merge double posts parameter
    $vbulletin->options['mrgdp_timespan'] = $vbulletin->options['rcd_ta_doublepost_timespan'];
    $vbulletin->options['mrgdp_delimeter_enable'] = $vbulletin->options['rcd_ta_doublepost_show_splitter'];
}]]></phpcode>
		</plugin>
		<plugin active="1" executionorder="5">
			<title>Edit time limit and other variables</title>
			<hookname>showthread_post_start</hookname>
			<phpcode><![CDATA[if (is_rcd_ta_enabled())
{ 
    if (!$threadinfo['open'])
    {
        $show['rcd_ta_topic_closed_bg'] = $vbulletin->options['rcd_ta_closed_thread_bg_image_enable'];
    }
}]]></phpcode>
		</plugin>
	</plugins>
	<phrases>
		<phrasetype name="GLOBAL" fieldname="global">
			<phrase name="notice_ta_new_reply_html" date="1232129655" username="Wildev" version=""><![CDATA[<!-- -->]]></phrase>
			<phrase name="notice_ta_new_thread_html" date="1232129430" username="Wildev" version=""><![CDATA[<!-- -->]]></phrase>
		</phrasetype>
		<phrasetype name="vBulletin Settings" fieldname="vbsettings">
			<phrase name="setting_rcd_ta_closed_thread_bg_image_enable_desc" date="1277278094" username="varnak" version="0.11" />
			<phrase name="setting_rcd_ta_closed_thread_bg_image_enable_title" date="1277278094" username="varnak" version="0.11"><![CDATA[Show background image for closed threads?]]></phrase>
			<phrase name="setting_rcd_ta_doublepost_show_splitter_desc" date="1277278051" username="varnak" version="0.11" />
			<phrase name="setting_rcd_ta_doublepost_show_splitter_title" date="1277278051" username="varnak" version="0.11"><![CDATA[Doubleposting use delimeter]]></phrase>
			<phrase name="setting_rcd_ta_doublepost_timespan_desc" date="1277278071" username="varnak" version="0.11"><![CDATA[How many minutes until a new post is no longer considered as doublepost?]]></phrase>
			<phrase name="setting_rcd_ta_doublepost_timespan_title" date="1277278071" username="varnak" version="0.11"><![CDATA[Doubleposting timespan]]></phrase>
			<phrase name="setting_rcd_ta_forum_ids_desc" date="1277383601" username="Vitaly" version="0.11"><![CDATA[Trade Area forum ids (comma separated)]]></phrase>
			<phrase name="setting_rcd_ta_forum_ids_title" date="1277383601" username="Vitaly" version="0.11"><![CDATA[Forum IDs]]></phrase>
			<phrase name="setting_rcd_ta_show_sticky_city_desc" date="1277278115" username="varnak" version="0.11" />
			<phrase name="setting_rcd_ta_show_sticky_city_title" date="1277278115" username="varnak" version="0.11"><![CDATA[Show city name for sticky threads?]]></phrase>
			<phrase name="setting_rcd_ta_x_and_children_desc" date="1277298541" username="Vitaly" version="0.11" />
			<phrase name="setting_rcd_ta_x_and_children_title" date="1277298541" username="Vitaly" version="0.11"><![CDATA[Include subforums]]></phrase>
			<phrase name="settinggroup_rcd_trade_area" date="1230979079" username="Wildev" version="0.2"><![CDATA[Trade Area]]></phrase>
		</phrasetype>
	</phrases>
	<options>
		<settinggroup name="rcd_trade_area" displayorder="10000">
			<setting varname="rcd_ta_forum_ids" displayorder="10">
				<datatype>free</datatype>
				<defaultvalue>14,15,16,17,18,28,50,51,97</defaultvalue>
			</setting>
			<setting varname="rcd_ta_x_and_children" displayorder="20">
				<datatype>boolean</datatype>
				<optioncode>yesno</optioncode>
				<defaultvalue>1</defaultvalue>
			</setting>
			<setting varname="rcd_ta_show_sticky_city" displayorder="30">
				<datatype>boolean</datatype>
				<optioncode>yesno</optioncode>
				<defaultvalue>1</defaultvalue>
			</setting>
			<setting varname="rcd_ta_closed_thread_bg_image_enable" displayorder="40">
				<datatype>boolean</datatype>
				<optioncode>yesno</optioncode>
				<defaultvalue>1</defaultvalue>
			</setting>
			<setting varname="rcd_ta_doublepost_timespan" displayorder="50">
				<datatype>number</datatype>
				<defaultvalue>10080</defaultvalue>
			</setting>
			<setting varname="rcd_ta_doublepost_show_splitter" displayorder="60">
				<datatype>boolean</datatype>
				<optioncode>yesno</optioncode>
				<defaultvalue>1</defaultvalue>
			</setting>
		</settinggroup>
	</options>
	<helptopics>
	</helptopics>
	<cronentries>
	</cronentries>
	<faqentries>
	</faqentries>
	<templateedits>
		<templateedit template="postbit_legacy" varname="rcd_ta_postbit_close_lmg" username="varnak" version="4.0.4" dateline="1277290314" searchorder="5" active="1">
			<title>Image for closed post</title>
			<searchstr><![CDATA[<div class="postbody">]]></searchstr>
			<replacestr><![CDATA[<div class="postbody" 
<vb:if condition="$show['rcd_ta_topic_closed_bg']">style="background: url({vb:stylevar imgdir_misc}/topic_closed_bg.png ) center;"</vb:if>>]]></replacestr>
		</templateedit>
		<templateedit template="threadbit" varname="rcd_ta_thread_city" username="Vitaly" version="4.0.4" dateline="1277383388" searchorder="5" active="1">
			<title>City in threads list</title>
			<searchstr><![CDATA[			<div class="threaddetails td">
				<div class="threaddetailicons">]]></searchstr>
			<replacestr><![CDATA[			<div class="threaddetails td">
				<div class="threaddetailicons">
<vb:if condition="$show['rcd_ta_city'] AND !($thread['sticky'] AND !$vboptions['rcd_ta_show_sticky_city'])"><span class="shade" style="vertical-align:top;" >{vb:raw thread.threadusercity}</span></vb:if>]]></replacestr>
		</templateedit>
	</templateedits>
</product>
